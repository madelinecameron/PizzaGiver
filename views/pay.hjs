<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Pizza For You!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script>
		var socket = io('http://localhost:3000');
    $(function() {
      var id = window.location.href.slice(window.location.href.lastIndexOf('/') + 1);
      socket.emit('getSelectedPizza', {id: id});
    });

		$(document).on('blur', '#cc', function() {
			var ccNum = $('#cc').val().replace(' ', '');
      console.log(ccNum);
			if(/^4[0-9]{6,}$/.test(ccNum.toString())) { //Visa
				$('#ccimg').attr('src', '/public/images/visa.png');
        return;
			}
			if(/^3[47][0-9]{5,}$/.test(ccNum.toString())) { //Amex
				$('#ccimg').attr('src', '/public/images/amex.png');
        return;
			}
			else {
				$('#ccimg').attr('src', '/public/images/mastercard.png'); //Else, we assume it is a Mastercard
        return;
			}
		});

    </script>
    <div class="container panel panel-default">
		<form>
			<div class="form-group">
				<label for="name">First name</label>
				<p class="form-control-static" id="name">{{friendName}}</p>
			</div>
      {{#friendMsg}}
			<div class="form-group">
				<label for="msg">Message</label>
				<p class="form-control-static" id="msg">{{friendMsg}}</p>
			</div>
      {{/friendMsg}}
		</form>
		<div id="displayPanel" class="panel panel-default" style="display:none">
			<div class="panel-heading">Stores near you:</div>
			<ul id="storeListings" class="panel-body list-group">
			</ul>
		</div>
		<div id="pizzaPanel" class="panel panel-default">
			<div class="panel-heading">Selected pizza</div>
			<ul id="storeListings" class="panel-body list-group">
				<li class="container list-group-item" style="width:inherit;{{#cheeseSelected}}background-color:#6495ed{{/cheeseSelected}}">
          <div id="cheese" class="{{cheeseSelected}}">Cheese</div>
        </li>
				<li class="container list-group-item" style="width:inherit;{{#pepperoniSelected}}background-color:#6495ed{{/pepperoniSelected}}">
          <div id="pepperoni" class="{{pepperoniSelected}}">Pepperoni</div>
        </li>
				<li class="container list-group-item" style="width:inherit;{{#sausageSelected}}background-color:#6495ed{{/sausageSelected}}">
          <div id="sausage" class="{{sausageSelected}}">Sausage</div>
        </li>
			</ul>
		</div>
		<br>
		<form>
			<div class="form-group form-inline">
				<label for="cc">Card number: </label><br>
				<input type="text" class="form-control" id="cc" placeholder="Card number">
				<img src="" alt="" id="ccimg" style="height:40px;width:60px"/>
			</div>
			<div class="form-group form-inline">
				<label for="expiration">Expiration: </label>
				<br>
				<select class="form-control">
					<option>01</option>
					<option>02</option>
					<option>03</option>
					<option>04</option>
					<option>05</option>
					<option>06</option>
					<option>07</option>
					<option>08</option>
					<option>09</option>
					<option>10</option>
					<option>11</option>
					<option>12</option>
				</select>
				<select class="form-control">
					<option>15</option>
					<option>16</option>
				</select>
			</div>
			<div class="form-group">
				<label for="seccode">Security Code: </label>
				<input type="text" class="form-control" id="seccode" placeholder="000" style="width:50px">
			</div>
			<button id="sendPizza" type="button" class="btn btn-default">Send pizza!</button>
		</form>
		<br>
		<div id="orderUrl"></div>
    </div>
</body>
</html>
